package com.arvindand.mcp.maven.model.security;

import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.databind.PropertyNamingStrategies;
import com.fasterxml.jackson.databind.annotation.JsonNaming;

/**
 * Individual vulnerability information from OSV database.
 *
 * @param id vulnerability identifier (e.g., "GHSA-jfh8-c2jp-5v3q" or "CVE-2021-44228")
 * @param severity severity classification
 * @param cvssScore CVSS score (0.0-10.0)
 * @param summary brief description of the vulnerability
 * @param fixedVersion version that fixes the vulnerability (nullable if no fix available)
 * @param reference URL to advisory
 * @author Arvind Menon
 * @since 2.0.0
 */
@JsonNaming(PropertyNamingStrategies.SnakeCaseStrategy.class)
@JsonInclude(JsonInclude.Include.NON_NULL)
public record VulnerabilityInfo(
    String id,
    Severity severity,
    double cvssScore,
    String summary,
    String fixedVersion,
    String reference) {

  /** Vulnerability severity classification. */
  public enum Severity {
    CRITICAL(4),
    HIGH(3),
    MEDIUM(2),
    LOW(1),
    UNKNOWN(0);

    private final int weight;

    Severity(int weight) {
      this.weight = weight;
    }

    public int weight() {
      return weight;
    }

    /**
     * Classify severity from CVSS score.
     *
     * @param score CVSS score (0.0-10.0)
     * @return corresponding severity level
     */
    public static Severity fromCvss(double score) {
      if (score >= 9.0) return CRITICAL;
      if (score >= 7.0) return HIGH;
      if (score >= 4.0) return MEDIUM;
      if (score >= 0.1) return LOW;
      return UNKNOWN;
    }
  }

  /** Check if this vulnerability is critical or high severity. */
  public boolean isCriticalOrHigh() {
    return severity == Severity.CRITICAL || severity == Severity.HIGH;
  }
}
